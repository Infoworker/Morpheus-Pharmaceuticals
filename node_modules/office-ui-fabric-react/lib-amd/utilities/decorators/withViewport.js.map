{"version":3,"sources":["utilities/decorators/withViewport.tsx"],"names":[],"mappings":";;;;;;;;;;;;;;;IAcA,IAAM,YAAY,GAAG,GAAG,CAAC;IAEzB,sBAAoE,iBAA4E;QAE9I,MAAM,CAAC;YAAoC,yCAAoC;YAM7E;gBACE,iBAAO,CAAC;gBAER,IAAI,CAAC,KAAK,GAAG;oBACX,QAAQ,EAAE;wBACR,KAAK,EAAE,CAAC;wBACR,MAAM,EAAE,CAAC;qBACV;iBACF,CAAC;YACJ,CAAC;YAEM,iDAAiB,GAAxB;gBACE,IAAI,CAAC,cAAc,GAAG,IAAI,CAAC,MAAM,CAAC,QAAQ,CACxC,IAAI,CAAC,cAAc,EACnB,YAAY,EACZ;oBACE,OAAO,EAAE,KAAK;iBACf,CAAC,CAAC;gBAEL,IAAI,CAAC,OAAO,CAAC,EAAE,CAAC,MAAM,EAAE,QAAQ,EAAE,IAAI,CAAC,cAAc,CAAC,CAAC;gBACvD,IAAI,CAAC,eAAe,EAAE,CAAC;YACzB,CAAC;YAEM,oDAAoB,GAA3B;gBACE,IAAI,CAAC,OAAO,CAAC,OAAO,EAAE,CAAC;YACzB,CAAC;YAEM,sCAAM,GAAb;gBACQ,kCAAQ,CAAgB;gBAC9B,IAAI,iBAAiB,GAAG,QAAQ,CAAC,KAAK,GAAG,CAAC,IAAI,QAAQ,CAAC,MAAM,GAAG,CAAC,CAAC;gBAElE,MAAM,CAAC,CACL,qBAAC,GAAG,IAAC,SAAS,EAAC,aAAa,EAAC,GAAG,EAAC,MAAM,EAAC,KAAK,EAAG,EAAE,QAAQ,EAAE,CAAC,EAAE,SAAS,EAAE,CAAC,EAAI,GAC3E,iBAAiB,IAAI,CACrB,oBAAC,iBAAiB,YAAC,GAAG,EAAG,IAAI,CAAC,2BAA6B,EAAC,QAAQ,EAAG,QAAU,GAAM,IAAI,CAAC,KAAK,EAAK,CACrG,CACC,CACP,CAAC;YACJ,CAAC;YAEM,2CAAW,GAAlB;gBACE,IAAI,CAAC,eAAe,CAAC,IAAI,CAAC,CAAC;YAC7B,CAAC;YAEO,8CAAc,GAAtB;gBACE,IAAI,CAAC,eAAe,EAAE,CAAC;YACzB,CAAC;YAEO,+CAAe,GAAvB,UAAwB,eAAyB;gBAAjD,iBA0BC;gBAzBO,kCAAQ,CAAgB;gBAC9B,IAAI,eAAe,GAAI,IAAI,CAAC,IAAY,CAAC,IAAI,CAAC;gBAC9C,IAAI,aAAa,GAAG,6BAAoB,CAAC,eAAe,CAAC,CAAC;gBAC1D,IAAI,UAAU,GAAG,aAAO,CAAC,aAAa,CAAC,CAAC;gBACxC,IAAI,UAAU,GAAG,aAAO,CAAC,eAAe,CAAC,CAAC;gBAC1C,IAAI,eAAe,GAAG;oBACpB,EAAE,CAAC,CAAC,eAAe,IAAI,KAAI,CAAC,0BAA0B,CAAC,CAAC,CAAC;wBACvD,KAAI,CAAC,0BAA0B,CAAC,WAAW,EAAE,CAAC;oBAChD,CAAC;gBACH,CAAC,CAAC;gBAEF,IAAI,aAAa,GAAG,CAClB,UAAU,CAAC,KAAK,KAAK,QAAQ,CAAC,KAAK;oBACnC,UAAU,CAAC,MAAM,KAAK,QAAQ,CAAC,MAAM,CAAC,CAAC;gBAEzC,EAAE,CAAC,CAAC,aAAa,CAAC,CAAC,CAAC;oBAClB,IAAI,CAAC,QAAQ,CAAC;wBACZ,QAAQ,EAAE;4BACR,KAAK,EAAE,UAAU,CAAC,KAAK;4BACvB,MAAM,EAAE,UAAU,CAAC,MAAM;yBAC1B;qBACF,EAAE,eAAe,CAAC,CAAC;gBACtB,CAAC;gBAAC,IAAI,CAAC,CAAC;oBACN,eAAe,EAAE,CAAC;gBACpB,CAAC;YACH,CAAC;YACH,4BAAC;QAAD,CAjFO,AAiFN,CAjF0C,6BAAa,EAiFvD,CAAC;IACJ,CAAC;IApFe,oBAAY,eAoF3B,CAAA","file":"utilities/decorators/withViewport.js","sourcesContent":["import * as React from 'react';\nimport { BaseDecorator } from './BaseDecorator';\nimport { findScrollableParent } from '../../utilities/scroll';\nimport { getRect } from '../../utilities/dom';\n\nexport interface IViewport {\n  width: number;\n  height: number;\n}\n\nexport interface IWithViewportState {\n  viewport?: IViewport;\n}\n\nconst RESIZE_DELAY = 500;\n\nexport function withViewport<P extends { viewport?: IViewport }, S>(ComposedComponent: (new (props: P, ...args: any[]) => React.Component<P, S>)): any {\n\n  return class WithViewportComponent extends BaseDecorator<P, IWithViewportState> {\n\n    public refs: {\n      [key: string]: React.ReactInstance;\n    };\n\n    constructor() {\n      super();\n\n      this.state = {\n        viewport: {\n          width: 0,\n          height: 0\n        }\n      };\n    }\n\n    public componentDidMount() {\n      this._onAsyncResize = this._async.debounce(\n        this._onAsyncResize,\n        RESIZE_DELAY,\n        {\n          leading: false\n        });\n\n      this._events.on(window, 'resize', this._onAsyncResize);\n      this._updateViewport();\n    }\n\n    public componentWillUnmount() {\n      this._events.dispose();\n    }\n\n    public render() {\n      let { viewport } = this.state;\n      let isViewportVisible = viewport.width > 0 && viewport.height > 0;\n\n      return (\n        <div className='ms-Viewport' ref='root' style={ { minWidth: 1, minHeight: 1 } }>\n          { isViewportVisible && (\n            <ComposedComponent ref={ this._updateComposedComponentRef } viewport={ viewport } { ...this.props } />\n          ) }\n        </div>\n      );\n    }\n\n    public forceUpdate() {\n      this._updateViewport(true);\n    }\n\n    private _onAsyncResize() {\n      this._updateViewport();\n    }\n\n    private _updateViewport(withForceUpdate?: boolean) {\n      let { viewport } = this.state;\n      let viewportElement = (this.refs as any).root;\n      let scrollElement = findScrollableParent(viewportElement);\n      let scrollRect = getRect(scrollElement);\n      let clientRect = getRect(viewportElement);\n      let updateComponent = () => {\n        if (withForceUpdate && this._composedComponentInstance) {\n          this._composedComponentInstance.forceUpdate();\n        }\n      };\n\n      let isSizeChanged = (\n        clientRect.width !== viewport.width ||\n        scrollRect.height !== viewport.height);\n\n      if (isSizeChanged) {\n        this.setState({\n          viewport: {\n            width: clientRect.width,\n            height: scrollRect.height\n          }\n        }, updateComponent);\n      } else {\n        updateComponent();\n      }\n    }\n  };\n}\n"],"sourceRoot":"../../../src"}