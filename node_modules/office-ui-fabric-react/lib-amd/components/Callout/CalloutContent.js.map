{"version":3,"sources":["components/Callout/CalloutContent.tsx"],"names":[],"mappings":"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","file":"components/Callout/CalloutContent.js","sourcesContent":["/* tslint:disable:no-unused-variable */\nimport * as React from 'react';\n/* tslint:enable:no-unused-variable */\nimport { ICalloutProps } from './Callout.Props';\nimport { DirectionalHint } from '../../common/DirectionalHint';\nimport {\n  autobind,\n  css,\n  elementContains\n} from '../../Utilities';\nimport { getRelativePositions, IPositionInfo } from '../../utilities/positioning';\nimport { IRectangle } from '../../common/IRectangle';\nimport { focusFirstChild } from '../../utilities/focus';\nimport { assign } from '../../Utilities';\nimport { Popup } from '../Popup/index';\nimport { BaseComponent } from '../../common/BaseComponent';\nimport './Callout.scss';\n\nconst BEAK_ORIGIN_POSITION = { top: 0, left: 0 };\nconst OFF_SCREEN_POSITION = { top: -9999, left: 0 };\nconst BORDER_WIDTH: number = 1;\nconst SPACE_FROM_EDGE: number = 8;\nexport interface ICalloutState {\n  positions?: any;\n  slideDirectionalClassName?: string;\n  calloutElementRect?: ClientRect;\n}\n\nexport class CalloutContent extends BaseComponent<ICalloutProps, ICalloutState> {\n\n  public static defaultProps = {\n    isBeakVisible: true,\n    beakWidth: 28,\n    gapSpace: 0,\n    directionalHint: DirectionalHint.bottomAutoEdge\n  };\n\n  private _didSetInitialFocus: boolean;\n  private _hostElement: HTMLDivElement;\n  private _calloutElement: HTMLDivElement;\n  private _targetWindow: Window;\n  private _bounds: IRectangle;\n  private _maxHeight: number;\n  private _positionAttempts: number;\n\n  constructor(props: ICalloutProps) {\n    super(props, {'beakStyle': 'beakWidth'});\n\n    this._didSetInitialFocus = false;\n    this.state = {\n      positions: null,\n      slideDirectionalClassName: null,\n      calloutElementRect: null\n    };\n    // This is used to allow the Callout to appear on a window other than the one the javascript is running in.\n    if (props.targetElement && props.targetElement.ownerDocument && props.targetElement.ownerDocument.defaultView) {\n      this._targetWindow = props.targetElement.ownerDocument.defaultView;\n    } else {\n      this._targetWindow = window;\n    }\n    this._positionAttempts = 0;\n  }\n\n  public componentDidUpdate() {\n    this._setInitialFocus();\n    this._updatePosition();\n  }\n\n  public componentDidMount() {\n    this._onComponentDidMount();\n  }\n\n  public render() {\n    let { className, targetElement, isBeakVisible, beakStyle, children, beakWidth } = this.props;\n    let { positions, slideDirectionalClassName } = this.state;\n    let beakStyleWidth = beakWidth;\n\n    // This is here to support the old way of setting the beak size until version 1.0.0.\n    // beakStyle is now deprecated and will be be removed at version 1.0.0\n    if (beakStyle === 'ms-Callout-smallbeak') {\n      beakStyleWidth = 16;\n    }\n\n    let beakReactStyle: React.CSSProperties = {\n      top: positions && positions.beak ? positions.beak.top : BEAK_ORIGIN_POSITION.top,\n      left: positions && positions.beak ? positions.beak.left : BEAK_ORIGIN_POSITION.left,\n      height: beakStyleWidth,\n      width: beakStyleWidth\n    };\n\n    let contentMaxHeight: number = this._getMaxHeight();\n    let beakVisible: boolean = isBeakVisible && !!targetElement;\n    let content = (\n      <div ref={ this._resolveRef('_hostElement') } className={ 'ms-Callout-container' }>\n        <div\n          className={\n            css(\n              'ms-Callout',\n              className,\n              slideDirectionalClassName ? `ms-u-${slideDirectionalClassName}` : ''\n            ) }\n          style={ positions ? positions.callout : OFF_SCREEN_POSITION }\n          ref={ this._resolveRef('_calloutElement') }\n          >\n\n          { beakVisible ? (\n            <div\n              className={ 'ms-Callout-beak' }\n              style={ beakReactStyle }\n              />) : (null) }\n\n          { beakVisible ?\n            (<div className='ms-Callout-beakCurtain' />) :\n            (null) }\n\n          <Popup\n            className='ms-Callout-main'\n            onDismiss={ (ev: any) => this.dismiss() }\n            shouldRestoreFocus={ true }\n            style={ { maxHeight: contentMaxHeight } }>\n            { children }\n          </Popup>\n        </div>\n      </div>\n    );\n    return content;\n  }\n\n  public dismiss() {\n    let { onDismiss } = this.props;\n\n    if (onDismiss) {\n      onDismiss();\n    }\n  }\n\n  protected _dismissOnLostFocus(ev: Event) {\n    let { targetElement } = this.props;\n    let target = ev.target as HTMLElement;\n\n    if (ev.target !== this._targetWindow &&\n      this._hostElement &&\n      !elementContains(this._hostElement, target) &&\n      (!targetElement || !elementContains(targetElement, target))) {\n      this.dismiss();\n    }\n  }\n\n  @autobind\n  protected _setInitialFocus() {\n    if (this.props.setInitialFocus && !this._didSetInitialFocus && this.state.positions) {\n      this._didSetInitialFocus = true;\n      focusFirstChild(this._calloutElement);\n    }\n  }\n\n  @autobind\n  protected _onComponentDidMount() {\n    // This is added so the callout will dismiss when the window is scrolled\n    // but not when something inside the callout is scrolled.\n    this._events.on(this._targetWindow, 'scroll', this._dismissOnLostFocus, true);\n    this._events.on(this._targetWindow, 'resize', this.dismiss, true);\n    this._events.on(this._targetWindow, 'focus', this._dismissOnLostFocus, true);\n    this._events.on(this._targetWindow, 'click', this._dismissOnLostFocus, true);\n\n    if (this.props.onLayerMounted) {\n      this.props.onLayerMounted();\n    }\n\n    this._updatePosition();\n  }\n\n  private _updatePosition() {\n    let { positions } = this.state;\n    let hostElement: HTMLElement = this._hostElement;\n    let calloutElement: HTMLElement = this._calloutElement;\n\n    if (hostElement && calloutElement) {\n      let currentProps: ICalloutProps;\n      currentProps = assign(currentProps, this.props);\n      currentProps.bounds = this._getBounds();\n      let positionInfo: IPositionInfo = getRelativePositions(currentProps, hostElement, calloutElement);\n\n      // Set the new position only when the positions are not exists or one of the new callout positions are different.\n      // The position should not change if the position is within 2 decimal places.\n      if ((!positions && positionInfo) ||\n        (positions && positionInfo &&\n          (positions.callout.top.toFixed(2) !== positionInfo.calloutPosition.top.toFixed(2) ||\n            positions.callout.left.toFixed(2) !== positionInfo.calloutPosition.left.toFixed(2))\n          && this._positionAttempts < 5)) {\n        // We should not reposition the callout more than a few times, if it is then the content is likely resizing\n        // and we should stop trying to reposition to prevent a stack overflow.\n        this._positionAttempts++;\n        this.setState({\n          positions: {\n            callout: positionInfo.calloutPosition,\n            beak: positionInfo.beakPosition,\n          },\n          slideDirectionalClassName: positionInfo.directionalClassName\n        });\n      }\n    } else {\n      this._positionAttempts = 0;\n    }\n  }\n\n  private _getBounds(): IRectangle {\n    if (!this._bounds) {\n      let currentBounds = this.props.bounds;\n\n      if (!currentBounds) {\n        currentBounds = {\n          top: 0 + SPACE_FROM_EDGE,\n          left: 0 + SPACE_FROM_EDGE,\n          right: this._targetWindow.innerWidth - SPACE_FROM_EDGE,\n          bottom: this._targetWindow.innerHeight - SPACE_FROM_EDGE,\n          width: this._targetWindow.innerWidth - SPACE_FROM_EDGE * 2,\n          height: this._targetWindow.innerHeight - SPACE_FROM_EDGE * 2\n        };\n      }\n      this._bounds = currentBounds;\n    }\n    return this._bounds;\n  }\n\n  private _getMaxHeight(): number {\n    if (!this._maxHeight) {\n      this._maxHeight = this._getBounds().height - BORDER_WIDTH * 2;\n    }\n    return this._maxHeight;\n  }\n}\n"],"sourceRoot":"../../../src"}