{"version":3,"sources":["components/Callout/CalloutContent.tsx"],"names":[],"mappings":"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","file":"components/Callout/CalloutContent.js","sourcesContent":["/* tslint:disable:no-unused-variable */\nimport * as React from 'react';\n/* tslint:enable:no-unused-variable */\nimport { ICalloutProps } from './Callout.Props';\nimport { DirectionalHint } from '../../common/DirectionalHint';\nimport {\n  autobind,\n  css,\n  elementContains\n} from '../../Utilities';\nimport { getRelativePositions, IPositionInfo } from '../../utilities/positioning';\nimport { IRectangle } from '../../common/IRectangle';\nimport { focusFirstChild } from '../../utilities/focus';\nimport { assign } from '../../Utilities';\nimport { Popup } from '../Popup/index';\nimport { BaseComponent } from '../../common/BaseComponent';\nimport './Callout.scss';\n\nconst BEAK_ORIGIN_POSITION = { top: 0, left: 0 };\nconst OFF_SCREEN_POSITION = { top: -9999, left: 0 };\nconst BORDER_WIDTH: number = 1;\nconst SPACE_FROM_EDGE: number = 8;\nexport interface ICalloutState {\n  positions?: any;\n  slideDirectionalClassName?: string;\n  calloutElementRect?: ClientRect;\n}\n\nexport class CalloutContent extends BaseComponent<ICalloutProps, ICalloutState> {\n\n  public static defaultProps = {\n    isBeakVisible: true,\n    beakWidth: 28,\n    gapSpace: 0,\n    directionalHint: DirectionalHint.bottomAutoEdge\n  };\n\n  private _didSetInitialFocus: boolean;\n  private _hostElement: HTMLDivElement;\n  private _calloutElement: HTMLDivElement;\n  private _targetWindow: Window;\n  private _bounds: IRectangle;\n  private _maxHeight: number;\n  private _positionAttempts: number;\n\n  constructor(props: ICalloutProps) {\n    super(props, {'beakStyle': 'beakWidth'});\n\n    this._didSetInitialFocus = false;\n    this.state = {\n      positions: null,\n      slideDirectionalClassName: null,\n      calloutElementRect: null\n    };\n    // This is used to allow the Callout to appear on a window other than the one the javascript is running in.\n    if (props.targetElement && props.targetElement.ownerDocument && props.targetElement.ownerDocument.defaultView) {\n      this._targetWindow = props.targetElement.ownerDocument.defaultView;\n    } else {\n      this._targetWindow = window;\n    }\n    this._positionAttempts = 0;\n  }\n\n  public componentDidUpdate() {\n    this._setInitialFocus();\n    this._updatePosition();\n  }\n\n  public componentDidMount() {\n    this._onComponentDidMount();\n  }\n\n  public render() {\n    let { className, targetElement, isBeakVisible, beakStyle, children, beakWidth } = this.props;\n    let { positions, slideDirectionalClassName } = this.state;\n    let beakStyleWidth = beakWidth;\n\n    // This is here to support the old way of setting the beak size until version 1.0.0.\n    // beakStyle is now deprecated and will be be removed at version 1.0.0\n    if (beakStyle === 'ms-Callout-smallbeak') {\n      beakStyleWidth = 16;\n    }\n\n    let beakReactStyle: React.CSSProperties = {\n      top: positions && positions.beak ? positions.beak.top : BEAK_ORIGIN_POSITION.top,\n      left: positions && positions.beak ? positions.beak.left : BEAK_ORIGIN_POSITION.left,\n      height: beakStyleWidth,\n      width: beakStyleWidth\n    };\n\n    let contentMaxHeight: number = this._getMaxHeight();\n    let beakVisible: boolean = isBeakVisible && !!targetElement;\n    let content = (\n      <div ref={ this._resolveRef('_hostElement') } className={ 'ms-Callout-container' }>\n        <div\n          className={\n            css(\n              'ms-Callout',\n              className,\n              slideDirectionalClassName ? `ms-u-${slideDirectionalClassName}` : ''\n            ) }\n          style={ positions ? positions.callout : OFF_SCREEN_POSITION }\n          ref={ this._resolveRef('_calloutElement') }\n          >\n\n          { beakVisible ? (\n            <div\n              className={ 'ms-Callout-beak' }\n              style={ beakReactStyle }\n              />) : (null) }\n\n          { beakVisible ?\n            (<div className='ms-Callout-beakCurtain' />) :\n            (null) }\n\n          <Popup\n            className='ms-Callout-main'\n            onDismiss={ (ev: any) => this.dismiss() }\n            shouldRestoreFocus={ true }\n            style={ { maxHeight: contentMaxHeight } }>\n            { children }\n          </Popup>\n        </div>\n      </div>\n    );\n    return content;\n  }\n\n  public dismiss() {\n    let { onDismiss } = this.props;\n\n    if (onDismiss) {\n      onDismiss();\n    }\n  }\n\n  protected _dismissOnLostFocus(ev: Event) {\n    let { targetElement } = this.props;\n    let target = ev.target as HTMLElement;\n\n    if (ev.target !== this._targetWindow &&\n      this._hostElement &&\n      !elementContains(this._hostElement, target) &&\n      (!targetElement || !elementContains(targetElement, target))) {\n      this.dismiss();\n    }\n  }\n\n  @autobind\n  protected _setInitialFocus() {\n    if (this.props.setInitialFocus && !this._didSetInitialFocus && this.state.positions) {\n      this._didSetInitialFocus = true;\n      focusFirstChild(this._calloutElement);\n    }\n  }\n\n  @autobind\n  protected _onComponentDidMount() {\n    // This is added so the callout will dismiss when the window is scrolled\n    // but not when something inside the callout is scrolled.\n    this._events.on(this._targetWindow, 'scroll', this._dismissOnLostFocus, true);\n    this._events.on(this._targetWindow, 'resize', this.dismiss, true);\n    this._events.on(this._targetWindow, 'focus', this._dismissOnLostFocus, true);\n    this._events.on(this._targetWindow, 'click', this._dismissOnLostFocus, true);\n\n    if (this.props.onLayerMounted) {\n      this.props.onLayerMounted();\n    }\n\n    this._updatePosition();\n  }\n\n  private _updatePosition() {\n    let { positions } = this.state;\n    let hostElement: HTMLElement = this._hostElement;\n    let calloutElement: HTMLElement = this._calloutElement;\n\n    if (hostElement && calloutElement) {\n      let currentProps: ICalloutProps;\n      currentProps = assign(currentProps, this.props);\n      currentProps.bounds = this._getBounds();\n      let positionInfo: IPositionInfo = getRelativePositions(currentProps, hostElement, calloutElement);\n\n      // Set the new position only when the positions are not exists or one of the new callout positions are different.\n      // The position should not change if the position is within 2 decimal places.\n      if ((!positions && positionInfo) ||\n        (positions && positionInfo &&\n          (positions.callout.top.toFixed(2) !== positionInfo.calloutPosition.top.toFixed(2) ||\n            positions.callout.left.toFixed(2) !== positionInfo.calloutPosition.left.toFixed(2))\n          && this._positionAttempts < 5)) {\n        // We should not reposition the callout more than a few times, if it is then the content is likely resizing\n        // and we should stop trying to reposition to prevent a stack overflow.\n        this._positionAttempts++;\n        this.setState({\n          positions: {\n            callout: positionInfo.calloutPosition,\n            beak: positionInfo.beakPosition,\n          },\n          slideDirectionalClassName: positionInfo.directionalClassName\n        });\n      }\n    } else {\n      this._positionAttempts = 0;\n    }\n  }\n\n  private _getBounds(): IRectangle {\n    if (!this._bounds) {\n      let currentBounds = this.props.bounds;\n\n      if (!currentBounds) {\n        currentBounds = {\n          top: 0 + SPACE_FROM_EDGE,\n          left: 0 + SPACE_FROM_EDGE,\n          right: this._targetWindow.innerWidth - SPACE_FROM_EDGE,\n          bottom: this._targetWindow.innerHeight - SPACE_FROM_EDGE,\n          width: this._targetWindow.innerWidth - SPACE_FROM_EDGE * 2,\n          height: this._targetWindow.innerHeight - SPACE_FROM_EDGE * 2\n        };\n      }\n      this._bounds = currentBounds;\n    }\n    return this._bounds;\n  }\n\n  private _getMaxHeight(): number {\n    if (!this._maxHeight) {\n      this._maxHeight = this._getBounds().height - BORDER_WIDTH * 2;\n    }\n    return this._maxHeight;\n  }\n}\n"],"sourceRoot":"../../../src"}